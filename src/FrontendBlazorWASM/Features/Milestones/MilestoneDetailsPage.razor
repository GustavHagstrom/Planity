@page "/milestones/{MilestoneId}"
@inject IMilestoneService MilestoneService
@inject NavigationManager NavigationManager
@inject IStringLocalizer<MilestoneDetailsPage> localizer

<EntityFormsPageLayout Title="@localizer["Milestoneinformation"]" IsLoading="milestone is null" OnSave="Save">
    <MainContent>
        <MilestoneForm @ref="form" Milestone="milestone"/>
    </MainContent>
</EntityFormsPageLayout>

@code {
    [Parameter] public string? MilestoneId { get; set; }
    [SupplyParameterFromQuery] public string? ReturnUrl { get; set; }

    private Milestone? milestone;
    MilestoneForm? form;

    protected override async Task OnInitializedAsync()
    {
        if (MilestoneId is not null)
        {
            milestone = await MilestoneService.GetAsync(MilestoneId);
        }
    }

    private async Task Save()
    {
        form?.Validate();
        if (form?.IsValid == true && milestone != null)
        {
            await MilestoneService.UpdateAsync(milestone);
            if (!string.IsNullOrEmpty(ReturnUrl))
            {
                NavigationManager.NavigateTo(ReturnUrl);
            }
            else
            {
                NavigationManager.NavigateTo(Planity.FrontendBlazorWASM.Routes.MilestonesOverview);
            }
        }
    }
}
