@page "/milestones/new"
@using Planity.FrontendBlazorWASM.Shared.Models
@inject IProjectService ProjectService
@inject NavigationManager NavigationManager
@using MudBlazor

<MudPaper Class="pa-4">
    <MudText Typo="Typo.h5">Ny milestone</MudText>
    <MudSelect T="string" Label="Projekt" @bind-Value="selectedProjectId" Required="true">
        @foreach (var project in Projects)
        {
            <MudSelectItem Value="@project.Id">@project.Name</MudSelectItem>
        }
    </MudSelect>
    <MilestoneForm OnSaved="OnMilestoneSaved" />
</MudPaper>

@code {
    private List<Project> Projects = new();
    private string? selectedProjectId;
    private Milestone newMilestone = new();

    protected override async Task OnInitializedAsync()
    {
        Projects = await ProjectService.GetProjectsAsync();
        selectedProjectId = Projects.FirstOrDefault()?.Id;
    }

    private async Task OnMilestoneSaved(Milestone milestone)
    {
        if (!string.IsNullOrEmpty(selectedProjectId))
        {
            await ProjectService.AddMilestoneToProjectAsync(selectedProjectId, milestone);
        }
        NavigationManager.NavigateTo(Planity.FrontendBlazorWASM.Routes.MilestonesOverview);
    }
}
