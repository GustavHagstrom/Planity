@page "/milestones/new"
@using Planity.FrontendBlazorWASM.Shared.Models
@inject IMilestoneService MilestoneService
@inject IProjectService ProjectService
@inject NavigationManager NavigationManager
@inject IStringLocalizer<MilestoneNewPage> localizer

<EntityFormsPageLayout Title="@localizer["Ny milestone"]" OnSave="Save">
    <MainContent>
        <MilestoneForm MilestoneModel="milestone" />
    </MainContent>
</EntityFormsPageLayout>


@code {
    private List<Project> Projects = new();
    private Milestone milestone = new();

    protected override async Task OnInitializedAsync()
    {
        Projects = await ProjectService.GetAllAsync();
        milestone.ProjectId = Projects.FirstOrDefault()?.Id ?? string.Empty;
    }

    private async Task Save()
    {
        if (!string.IsNullOrEmpty(milestone.ProjectId))
        {
            await MilestoneService.CreateAsync(milestone);
            NavigationManager.NavigateTo(Planity.FrontendBlazorWASM.Routes.MilestonesOverview);
        }
    }
}
