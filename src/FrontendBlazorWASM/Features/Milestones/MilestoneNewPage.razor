@page "/milestones/new"
@using Planity.FrontendBlazorWASM.Shared.Models
@inject IMilestoneService MilestoneService
@inject IProjectService ProjectService
@inject NavigationManager NavigationManager
@inject IStringLocalizer<MilestoneNewPage> localizer

<EntityFormsPageLayout Title="@localizer["Ny milestone"]" OnSave="Save">
    <MainContent>
        <MilestoneForm @ref="form" Milestone="milestone" ProjectId="@ProjectId" />
    </MainContent>
</EntityFormsPageLayout>


@code {
    private Milestone milestone = new();
    MilestoneForm? form;

    [SupplyParameterFromQuery] public string? ProjectId { get; set; }
    [SupplyParameterFromQuery] public string? ReturnUrl { get; set; }

    protected override void OnInitialized()
    {
        base.OnInitialized();
    }

    private async Task Save()
    {
        form?.Validate();
        if (form?.IsValid == true)
        {
            await MilestoneService.CreateAsync(milestone);
            if (!string.IsNullOrEmpty(ReturnUrl))
            {
                NavigationManager.NavigateTo(ReturnUrl);
                return;
            }
            else
            {
                NavigationManager.NavigateTo(Planity.FrontendBlazorWASM.Routes.MilestonesOverview);
            }
        }
    }
}
