@page "/tasks/{TaskId}"
@inject ITaskService TaskService
@inject NavigationManager NavigationManager
@inject IJSRuntime JS
@inject IStringLocalizer<TaskDetailsPage> localizer

<EntityFormsPageLayout Title="@localizer["Uppgiftsinformation"]" IsLoading="task is null" OnSave="Save">
    <MainContent>
        <TaskForm Task="task"/>
    </MainContent>
</EntityFormsPageLayout>

@code {
    [Parameter] public string? TaskId { get; set; }
    private ProjectTask? task;
    // private string? projectId;

    [SupplyParameterFromQuery] public string? ReturnUrl { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        if (TaskId != null)
            task = await TaskService.GetAsync(TaskId);
    }

    private async Task Save()
    {
        if (task != null)
        {
            await TaskService.UpdateAsync(task);
            if (!string.IsNullOrEmpty(ReturnUrl))
            {
                NavigationManager.NavigateTo(ReturnUrl);
                return;
            }
            NavigationManager.NavigateTo(Routes.TasksOverview);
        }
    }

}
