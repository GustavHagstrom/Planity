@page "/tasks/{TaskId}"
@inject ITaskService TaskService
@inject NavigationManager NavigationManager
@inject IJSRuntime JS
@inject IStringLocalizer<TaskDetailsPage> localizer

<EntityFormsPageLayout Title="@localizer["Uppgiftsinformation"]" IsLoading="task is null" OnSave="Save">
    <MainContent>
        <TaskForm @ref="taskForm" Task="task"/>
    </MainContent>
</EntityFormsPageLayout>

@code {
    [Parameter] public string? TaskId { get; set; }
    [SupplyParameterFromQuery] public string? ReturnUrl { get; set; }
    
    ProjectTask? task;
    TaskForm? taskForm;

    protected override async Task OnParametersSetAsync()
    {
        if (TaskId != null)
            task = await TaskService.GetAsync(TaskId);
    }

    private async Task Save()
    {
        taskForm?.Validate();
        if (task != null && taskForm?.IsValid == true)
        {
            await TaskService.UpdateAsync(task);
            if (!string.IsNullOrEmpty(ReturnUrl))
            {
                NavigationManager.NavigateTo(ReturnUrl);
                return;
            }
            NavigationManager.NavigateTo(Routes.TasksOverview);
        }
    }

}
