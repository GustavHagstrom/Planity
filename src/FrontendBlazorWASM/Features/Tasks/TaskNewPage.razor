@page "/tasks/new"
@inject ITaskService TaskService
@inject NavigationManager NavigationManager
@inject IStringLocalizer<TaskNewPage> localizer

<EntityFormsPageLayout Title="@localizer["Ny uppgift"]" IsLoading="newTask is null" OnSave="Save">
    <MainContent>
        <TaskForm @ref="taskForm" Task="newTask" ProjectId="@ProjectId" ResourceId="@ResourceId"/>
    </MainContent>
</EntityFormsPageLayout>

@code {

    TaskForm? taskForm;

    private ProjectTask newTask = new();

    [SupplyParameterFromQuery] public string? ProjectId { get; set; }
    [SupplyParameterFromQuery] public string? ReturnUrl { get; set; }
    [SupplyParameterFromQuery] public string? ResourceId { get; set; }


    private async Task Save()
    {
        taskForm?.Validate();
        if (taskForm?.IsValid ?? false)
        {
            await TaskService.CreateAsync(newTask);
            if (!string.IsNullOrEmpty(ReturnUrl))
            {
                NavigationManager.NavigateTo(ReturnUrl);
                return;
            }
            NavigationManager.NavigateTo(Planity.FrontendBlazorWASM.Routes.TasksOverview);
        }
        
    }
}
